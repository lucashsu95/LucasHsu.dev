import{_ as d,c as g,m as s,a as i,J as a,w as h,b as y,au as o,V as t,E as n,o as l}from"./chunks/framework.C9sE8QFS.js";const P=JSON.parse('{"title":"Lazy vs Eager è¼‰å…¥ç­–ç•¥ | LucasHsu.dev","description":"æ·±å…¥ç†è§£ JPA çš„ Lazy èˆ‡ Eager è¼‰å…¥æ™‚æ©Ÿï¼ŒæŒæ¡ N+1 å•é¡Œçš„è§£æ±ºä¹‹é“","frontmatter":{"title":"Lazy vs Eager è¼‰å…¥ç­–ç•¥ | LucasHsu.dev","description":"æ·±å…¥ç†è§£ JPA çš„ Lazy èˆ‡ Eager è¼‰å…¥æ™‚æ©Ÿï¼ŒæŒæ¡ N+1 å•é¡Œçš„è§£æ±ºä¹‹é“","head":[["meta",{"name":"keywords","content":"JPA, Lazy Loading, Eager Loading, N+1 å•é¡Œ, FetchType"}],["meta",{"property":"og:title","content":"Lazy vs Eager è¼‰å…¥ç­–ç•¥"}],["meta",{"property":"og:description","content":"æ·±å…¥ç†è§£ JPA çš„ Lazy èˆ‡ Eager è¼‰å…¥æ™‚æ©Ÿ"}],["meta",{"property":"og:type","content":"article"}]]},"headers":[],"relativePath":"java/spring-boot/lazy.md","filePath":"java/spring-boot/lazy.md","lastUpdated":1770277310000}'),A={name:"java/spring-boot/lazy.md"},c=t('<h1 id="lazy-vs-eager-è¼‰å…¥æ™‚æ©Ÿçš„å°æ±º" tabindex="-1">Lazy vs Eagerï¼šè¼‰å…¥æ™‚æ©Ÿçš„å°æ±º <a class="header-anchor" href="#lazy-vs-eager-è¼‰å…¥æ™‚æ©Ÿçš„å°æ±º" aria-label="Permalink to &quot;Lazy vs Eagerï¼šè¼‰å…¥æ™‚æ©Ÿçš„å°æ±º&quot;">â€‹</a></h1><blockquote><p>ğŸ“ TL;DRï¼š<strong>Lazy = æ‹–å»¶ç—‡æ‚£è€…</strong>ï¼ˆç”¨åˆ°æ‰è¼‰å…¥ï¼‰ã€<strong>Eager = å¼·è¿«ç—‡æ‚£è€…</strong>ï¼ˆä¸€æ¬¡å…¨æ‹¿ï¼‰ã€‚å¯¦å‹™ä¸Šå»ºè­°ã€Œå…¨ Lazy ç­–ç•¥ã€+ éœ€è¦æ™‚ç”¨ <code>JOIN FETCH</code> ç²¾æº–æŠ“å–ã€‚è¨˜ä½ï¼šLazy æ˜¯ä½ çš„æœ‹å‹ï¼ŒN+1 å•é¡Œæ‰æ˜¯é­”ç‹ï¼</p></blockquote><h2 id="å‰ç½®çŸ¥è­˜" tabindex="-1">å‰ç½®çŸ¥è­˜ <a class="header-anchor" href="#å‰ç½®çŸ¥è­˜" aria-label="Permalink to &quot;å‰ç½®çŸ¥è­˜&quot;">â€‹</a></h2>',3),B=s("li",null,[s("strong",null,"JPA åŸºç¤"),i(" - Entity èˆ‡é—œè¯æ˜ å°„ï¼ˆ"),s("code",null,"@OneToMany"),i("ã€"),s("code",null,"@ManyToOne"),i("ï¼‰")],-1),D=s("strong",null,"æŒä¹…åŒ–ä¸Šä¸‹æ–‡",-1),E=t(`<h2 id="ä»€éº¼æ˜¯-lazy-eager-loading" tabindex="-1">ä»€éº¼æ˜¯ Lazy / Eager Loadingï¼Ÿ <a class="header-anchor" href="#ä»€éº¼æ˜¯-lazy-eager-loading" aria-label="Permalink to &quot;ä»€éº¼æ˜¯ Lazy / Eager Loadingï¼Ÿ&quot;">â€‹</a></h2><p>æƒ³åƒä½ å»åƒåˆ°é£½é¤å»³ï¼š</p><table><thead><tr><th>ç­–ç•¥</th><th>æ¯”å–»</th><th>è¡Œç‚º</th></tr></thead><tbody><tr><td><strong>Eager</strong></td><td>ä¸€é€²é–€å°±æŠŠæ‰€æœ‰èœéƒ½ç«¯ä¸Šæ¡Œ</td><td>æŸ¥ä¸»è¡¨æ™‚ï¼Œ<strong>ç«‹åˆ»</strong> æŠŠé—œè¯è³‡æ–™ä¸€èµ·è¼‰å…¥</td></tr><tr><td><strong>Lazy</strong></td><td>æƒ³åƒä»€éº¼å†å»å¤¾</td><td>æŸ¥ä¸»è¡¨æ™‚ <strong>ä¸è¼‰å…¥</strong> é—œè¯è³‡æ–™ï¼Œç­‰ä½ çœŸçš„å­˜å–æ™‚æ‰å»æŠ“</td></tr></tbody></table><h3 id="jpa-é è¨­è¡Œç‚º" tabindex="-1">JPA é è¨­è¡Œç‚º <a class="header-anchor" href="#jpa-é è¨­è¡Œç‚º" aria-label="Permalink to &quot;JPA é è¨­è¡Œç‚º&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">ManyToOne</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   // é è¨­ Eager ğŸ˜±</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">OneToOne</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // é è¨­ Eager ğŸ˜±</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">OneToMany</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   // é è¨­ Lazy âœ…</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">ManyToMany</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // é è¨­ Lazy âœ…</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">ğŸš¨ é è¨­é™·é˜±</p><p><code>@ManyToOne</code> å’Œ <code>@OneToOne</code> é è¨­æ˜¯ <strong>Eager</strong>ï¼é€™ä»£è¡¨æ¯æ¬¡æŸ¥è©¢éƒ½æœƒé †ä¾¿æŠŠé—œè¯è³‡æ–™ä¸€èµ·æ’ˆå‡ºä¾†ï¼Œå³ä½¿ä½ æ ¹æœ¬ä¸éœ€è¦å®ƒå€‘ã€‚</p></div><h2 id="å•é¡Œä¾†äº†-n-1-å¤§é­”ç‹" tabindex="-1">å•é¡Œä¾†äº†ï¼šN+1 å¤§é­”ç‹ <a class="header-anchor" href="#å•é¡Œä¾†äº†-n-1-å¤§é­”ç‹" aria-label="Permalink to &quot;å•é¡Œä¾†äº†ï¼šN+1 å¤§é­”ç‹&quot;">â€‹</a></h2><h3 id="ä»€éº¼æ˜¯-n-1-å•é¡Œ" tabindex="-1">ä»€éº¼æ˜¯ N+1 å•é¡Œï¼Ÿ <a class="header-anchor" href="#ä»€éº¼æ˜¯-n-1-å•é¡Œ" aria-label="Permalink to &quot;ä»€éº¼æ˜¯ N+1 å•é¡Œï¼Ÿ&quot;">â€‹</a></h3><p>å‡è¨­ä½ æœ‰ä¸€å€‹éƒ¨è½æ ¼ç³»çµ±ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Entity</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">ManyToOne</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // é è¨­ Eagerï¼</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Author</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> author</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><p>ç•¶ä½ æŸ¥è©¢ 10 ç¯‡æ–‡ç« æ™‚ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">List</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> posts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> postRepository</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">findAll</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span></code></pre></div><p><strong>å¯¦éš›ç™¼å‡ºçš„ SQLï¼š</strong></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- ç¬¬ 1 æ¬¡ï¼šæŸ¥æ‰€æœ‰æ–‡ç« </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> post;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- æ¥ä¸‹ä¾† 10 æ¬¡ï¼šæ¯ç¯‡æ–‡ç« å„æŸ¥ä¸€æ¬¡ä½œè€…ï¼ˆå› ç‚º Eagerï¼‰</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> author </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> author </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> author </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">...</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> author </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre></div><p><strong>ç¸½å…± 11 æ¬¡æŸ¥è©¢ï¼</strong> é€™å°±æ˜¯ N+1 å•é¡Œï¼ˆ1 æ¬¡ä¸»æŸ¥è©¢ + N æ¬¡é—œè¯æŸ¥è©¢ï¼‰ã€‚</p><p>å¦‚æœæœ‰ 1000 ç­†è³‡æ–™å‘¢ï¼Ÿæ­å–œä½ ï¼Œ1001 æ¬¡æŸ¥è©¢ï¼Œ<s>è³‡æ–™åº«è¡¨ç¤ºï¼šã€Œæˆ‘å…ˆå»ä¼‘æ¯ä¸€ä¸‹...ã€</s></p><h3 id="n-1-çš„å¯æ€•ä¹‹è™•" tabindex="-1">N+1 çš„å¯æ€•ä¹‹è™• <a class="header-anchor" href="#n-1-çš„å¯æ€•ä¹‹è™•" aria-label="Permalink to &quot;N+1 çš„å¯æ€•ä¹‹è™•&quot;">â€‹</a></h3><table><thead><tr><th>æ–‡ç« æ•¸é‡</th><th>æŸ¥è©¢æ¬¡æ•¸</th><th>æ•ˆèƒ½å½±éŸ¿</th></tr></thead><tbody><tr><td>10</td><td>11</td><td>é‚„è¡Œ</td></tr><tr><td>100</td><td>101</td><td>é–‹å§‹å¡äº†</td></tr><tr><td>1000</td><td>1001</td><td>è³‡æ–™åº«ï¼šã€Œå‘Šè¾­ã€</td></tr></tbody></table><h2 id="è§£æ±ºæ–¹æ³•" tabindex="-1">è§£æ±ºæ–¹æ³• <a class="header-anchor" href="#è§£æ±ºæ–¹æ³•" aria-label="Permalink to &quot;è§£æ±ºæ–¹æ³•&quot;">â€‹</a></h2><h3 id="_1-å…¨-lazy-ç­–ç•¥" tabindex="-1">1. å…¨ Lazy ç­–ç•¥ <a class="header-anchor" href="#_1-å…¨-lazy-ç­–ç•¥" aria-label="Permalink to &quot;1. å…¨ Lazy ç­–ç•¥&quot;">â€‹</a></h3><p><strong>æ‰‹å‹•æŠŠæ‰€æœ‰é—œè¯éƒ½æ”¹æˆ Lazyï¼š</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Entity</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">ManyToOne</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">fetch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> FetchType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">LAZY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // è¦†è“‹é è¨­çš„ Eager</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">JoinColumn</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">author_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Author</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> author</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">OneToOne</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">fetch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> FetchType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">LAZY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   // è¦†è“‹é è¨­çš„ Eager</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> PostDetail</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> detail</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">ğŸ’¡ å°ˆæ¥­å¿ƒæ³•</p><p>åœ¨å°ˆæ¥­çš„ Spring Boot é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘é€šå¸¸æ¡å–ã€Œ<strong>å…¨ Lazy ç­–ç•¥</strong>ã€ï¼š</p><ul><li>æ‰€æœ‰ <code>@ManyToOne</code> å’Œ <code>@OneToOne</code> éƒ½åŠ ä¸Š <code>fetch = FetchType.LAZY</code></li><li>éœ€è¦é—œè¯è³‡æ–™æ™‚ï¼Œå†ç”¨ <code>JOIN FETCH</code> ç²¾æº–æŠ“å–</li></ul></div><h3 id="_2-join-fetch-ç²¾æº–æŠ“å–" tabindex="-1">2. JOIN FETCHï¼šç²¾æº–æŠ“å– <a class="header-anchor" href="#_2-join-fetch-ç²¾æº–æŠ“å–" aria-label="Permalink to &quot;2. JOIN FETCHï¼šç²¾æº–æŠ“å–&quot;">â€‹</a></h3><p>ç•¶ç¢ºå®šéœ€è¦é—œè¯è³‡æ–™æ™‚ï¼Œç”¨ <code>JOIN FETCH</code> ä¸€æ¬¡æ’ˆå®Œï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Query</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT p FROM Post p JOIN FETCH p.author WHERE p.id = :id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Optional</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Post</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> findByIdWithAuthor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Param</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre></div><p><strong>åªç™¼å‡º 1 æ¬¡ SQLï¼š</strong></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> p.</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, a.</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> post p </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">JOIN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> author a </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ON</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> p</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">author_id</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> a</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> p</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">id</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ?;</span></span></code></pre></div><h3 id="_3-entitygraph-é€²éšæŠ€å·§" tabindex="-1">3. EntityGraphï¼ˆé€²éšæŠ€å·§ï¼‰ <a class="header-anchor" href="#_3-entitygraph-é€²éšæŠ€å·§" aria-label="Permalink to &quot;3. EntityGraphï¼ˆé€²éšæŠ€å·§ï¼‰&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">EntityGraph</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">attributePaths</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">author</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">comments</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">})</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Query</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT p FROM Post p WHERE p.id = :id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Optional</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Post</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> findByIdWithDetails</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Param</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre></div><h2 id="lazy-è¼‰å…¥çš„é™·é˜±-lazyinitializationexception" tabindex="-1">Lazy è¼‰å…¥çš„é™·é˜±ï¼šLazyInitializationException <a class="header-anchor" href="#lazy-è¼‰å…¥çš„é™·é˜±-lazyinitializationexception" aria-label="Permalink to &quot;Lazy è¼‰å…¥çš„é™·é˜±ï¼šLazyInitializationException&quot;">â€‹</a></h2><h3 id="ä»€éº¼æ™‚å€™æœƒç™¼ç”Ÿ" tabindex="-1">ä»€éº¼æ™‚å€™æœƒç™¼ç”Ÿï¼Ÿ <a class="header-anchor" href="#ä»€éº¼æ™‚å€™æœƒç™¼ç”Ÿ" aria-label="Permalink to &quot;ä»€éº¼æ™‚å€™æœƒç™¼ç”Ÿï¼Ÿ&quot;">â€‹</a></h3><p>ç•¶ä½ åœ¨ <strong>æŒä¹…åŒ–ä¸Šä¸‹æ–‡é—œé–‰å¾Œ</strong> å˜—è©¦å­˜å– Lazy å±¬æ€§ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">GetMapping</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/posts/{id}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> PostDTO </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getPost</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">PathVariable</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Post</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> postService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">findById</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // äº‹å‹™åœ¨é€™è£¡çµæŸ</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // LazyInitializationExceptionï¼</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // å› ç‚º Session å·²ç¶“é—œé–‰ï¼Œç„¡æ³•å†å»è³‡æ–™åº«æŠ“ author</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> authorName</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getAuthor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getName</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> new</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> PostDTO</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h3 id="è§£æ±ºæ–¹æ¡ˆ" tabindex="-1">è§£æ±ºæ–¹æ¡ˆ <a class="header-anchor" href="#è§£æ±ºæ–¹æ¡ˆ" aria-label="Permalink to &quot;è§£æ±ºæ–¹æ¡ˆ&quot;">â€‹</a></h3><p><strong>æ–¹æ¡ˆ 1ï¼šåœ¨ Service å±¤å°±æŠŠéœ€è¦çš„è³‡æ–™æŠ“å¥½</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Service</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> PostService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Post </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">findByIdWithAuthor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Long </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        // åœ¨äº‹å‹™å…§ç”¨ JOIN FETCH æŠ“å¥½</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        return</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> postRepository</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">findByIdWithAuthor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><p><strong>æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ DTO æŠ•å½±</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Query</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT new com.example.dto.PostDTO(p.id, p.title, a.name) </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">       &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">FROM Post p JOIN p.author a WHERE p.id = :id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PostDTO </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">findPostDTOById</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Param</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre></div><p><strong>æ–¹æ¡ˆ 3ï¼šé–‹å•Ÿ OSIVï¼ˆä¸æ¨è–¦ï¼‰</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">spring</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  jpa</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    open-in-view</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # è®“ Session æ´»åˆ° Controller çµæŸ</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">âš ï¸ OSIV çš„å•é¡Œ</p><p>é›–ç„¶ OSIV å¯ä»¥è§£æ±º <code>LazyInitializationException</code>ï¼Œä½†å®ƒæœƒè®“è³‡æ–™åº«é€£ç·šæŒæœ‰æ›´ä¹…ï¼Œåœ¨é«˜ä½µç™¼æƒ…æ³ä¸‹å¯èƒ½é€ æˆé€£ç·šæ± è€—ç›¡ã€‚<strong>å°ˆæ¥­å»ºè­°ï¼šé—œæ‰å®ƒï¼Œä¹–ä¹–ç”¨ JOIN FETCHã€‚</strong></p></div><h2 id="å¯¦éš›ç¯„ä¾‹" tabindex="-1">å¯¦éš›ç¯„ä¾‹ <a class="header-anchor" href="#å¯¦éš›ç¯„ä¾‹" aria-label="Permalink to &quot;å¯¦éš›ç¯„ä¾‹&quot;">â€‹</a></h2><h3 id="ç¯„ä¾‹-1-éƒ¨è½æ ¼æ–‡ç« ç³»çµ±" tabindex="-1">ç¯„ä¾‹ 1ï¼šéƒ¨è½æ ¼æ–‡ç« ç³»çµ± <a class="header-anchor" href="#ç¯„ä¾‹-1-éƒ¨è½æ ¼æ–‡ç« ç³»çµ±" aria-label="Permalink to &quot;ç¯„ä¾‹ 1ï¼šéƒ¨è½æ ¼æ–‡ç« ç³»çµ±&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Entity</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Id</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">GeneratedValue</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">strategy</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> GenerationType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">IDENTITY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> title</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">ManyToOne</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">fetch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> FetchType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">LAZY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // âœ… æ‰‹å‹• Lazy</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">JoinColumn</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">author_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Author</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> author</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">OneToMany</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">mappedBy</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">post</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> fetch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> FetchType</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">LAZY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // é è¨­å°±æ˜¯ Lazy</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> List</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Comment</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> comments</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Repository</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> interface</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> PostRepository</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> extends</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> JpaRepository</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> Long</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // åªè¦æ–‡ç« æœ¬èº«</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Optional</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> findById</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Long </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // æ–‡ç«  + ä½œè€…</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Query</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT p FROM Post p JOIN FETCH p.author WHERE p.id = :id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Optional</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> findByIdWithAuthor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Param</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // æ–‡ç«  + ä½œè€… + ç•™è¨€ï¼ˆæ³¨æ„ï¼šé›†åˆè¦ç”¨ LEFT JOIN FETCHï¼‰</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Query</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT DISTINCT p FROM Post p </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">           &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">JOIN FETCH p.author </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">           &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">LEFT JOIN FETCH p.comments </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">           &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">WHERE p.id = :id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Optional</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> findByIdWithAllDetails</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Param</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Long </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h3 id="ç¯„ä¾‹-2-åˆ¤æ–·ä½•æ™‚è©²ç”¨ä»€éº¼" tabindex="-1">ç¯„ä¾‹ 2ï¼šåˆ¤æ–·ä½•æ™‚è©²ç”¨ä»€éº¼ <a class="header-anchor" href="#ç¯„ä¾‹-2-åˆ¤æ–·ä½•æ™‚è©²ç”¨ä»€éº¼" aria-label="Permalink to &quot;ç¯„ä¾‹ 2ï¼šåˆ¤æ–·ä½•æ™‚è©²ç”¨ä»€éº¼&quot;">â€‹</a></h3>`,47),C=t('<h2 id="å¸¸è¦‹å•é¡Œ-faq" tabindex="-1">å¸¸è¦‹å•é¡Œ FAQ <a class="header-anchor" href="#å¸¸è¦‹å•é¡Œ-faq" aria-label="Permalink to &quot;å¸¸è¦‹å•é¡Œ FAQ&quot;">â€‹</a></h2><h3 id="q1-ä»€éº¼æ™‚å€™è©²ç”¨-eager" tabindex="-1">Q1ï¼šä»€éº¼æ™‚å€™è©²ç”¨ Eagerï¼Ÿ <a class="header-anchor" href="#q1-ä»€éº¼æ™‚å€™è©²ç”¨-eager" aria-label="Permalink to &quot;Q1ï¼šä»€éº¼æ™‚å€™è©²ç”¨ Eagerï¼Ÿ&quot;">â€‹</a></h3><p><strong>å¹¾ä¹ä¸ç”¨ã€‚</strong> é™¤éé€™å€‹é—œè¯è³‡æ–™ <strong>100% æ¯æ¬¡éƒ½æœƒç”¨åˆ°</strong>ï¼Œå¦å‰‡ Lazy + JOIN FETCH æ˜¯æ›´å¥½çš„é¸æ“‡ã€‚</p><h3 id="q2-lazy-æœƒè®“æŸ¥è©¢è®Šå¤šå—" tabindex="-1">Q2ï¼šLazy æœƒè®“æŸ¥è©¢è®Šå¤šå—ï¼Ÿ <a class="header-anchor" href="#q2-lazy-æœƒè®“æŸ¥è©¢è®Šå¤šå—" aria-label="Permalink to &quot;Q2ï¼šLazy æœƒè®“æŸ¥è©¢è®Šå¤šå—ï¼Ÿ&quot;">â€‹</a></h3><p>å¦‚æœä½ æ²’è™•ç†å¥½ï¼Œæœƒã€‚ä½†ç”¨ <code>JOIN FETCH</code> å°±èƒ½ä¸€æ¬¡æå®šï¼Œåè€Œæ¯” Eager æ›´æœ‰å½ˆæ€§ã€‚</p><h3 id="q3-é›†åˆç”¨-join-fetch-æœƒæœ‰ä»€éº¼å•é¡Œ" tabindex="-1">Q3ï¼šé›†åˆç”¨ JOIN FETCH æœƒæœ‰ä»€éº¼å•é¡Œï¼Ÿ <a class="header-anchor" href="#q3-é›†åˆç”¨-join-fetch-æœƒæœ‰ä»€éº¼å•é¡Œ" aria-label="Permalink to &quot;Q3ï¼šé›†åˆç”¨ JOIN FETCH æœƒæœ‰ä»€éº¼å•é¡Œï¼Ÿ&quot;">â€‹</a></h3><p>æœƒæœ‰ <strong>ç¬›å¡çˆ¾ç©å•é¡Œ</strong>ã€‚å¦‚æœä¸€ç¯‡æ–‡ç« æœ‰ 10 å‰‡ç•™è¨€ï¼Œçµæœé›†æœƒè®Šæˆ 10 è¡Œï¼ˆé‡è¤‡çš„æ–‡ç« è³‡æ–™ï¼‰ã€‚æ‰€ä»¥è¦åŠ  <code>DISTINCT</code>ï¼Œä½†è¨˜å¾—é€™æœƒåœ¨è¨˜æ†¶é«”ä¸­åšå»é‡ï¼Œå¤§è³‡æ–™é‡è¦å°å¿ƒã€‚</p><h2 id="æœ€ä½³å¯¦è¸" tabindex="-1">æœ€ä½³å¯¦è¸ <a class="header-anchor" href="#æœ€ä½³å¯¦è¸" aria-label="Permalink to &quot;æœ€ä½³å¯¦è¸&quot;">â€‹</a></h2><h3 id="âœ…-æ¨è–¦åšæ³•" tabindex="-1">âœ… æ¨è–¦åšæ³• <a class="header-anchor" href="#âœ…-æ¨è–¦åšæ³•" aria-label="Permalink to &quot;âœ… æ¨è–¦åšæ³•&quot;">â€‹</a></h3><ol><li><strong>å…¨éƒ¨é è¨­ Lazy</strong> - æ‰€æœ‰ <code>@XxxToOne</code> éƒ½åŠ  <code>fetch = FetchType.LAZY</code></li><li><strong>æŒ‰éœ€ Fetch</strong> - éœ€è¦æ™‚ç”¨ <code>JOIN FETCH</code> æˆ– <code>EntityGraph</code></li><li><strong>ç”¨ DTO æŠ•å½±</strong> - åªæŸ¥éœ€è¦çš„æ¬„ä½ï¼Œçœè¨˜æ†¶é«”åˆå¿«</li></ol><h3 id="âŒ-å¸¸è¦‹éŒ¯èª¤" tabindex="-1">âŒ å¸¸è¦‹éŒ¯èª¤ <a class="header-anchor" href="#âŒ-å¸¸è¦‹éŒ¯èª¤" aria-label="Permalink to &quot;âŒ å¸¸è¦‹éŒ¯èª¤&quot;">â€‹</a></h3><ol><li><strong>ç›¸ä¿¡é è¨­å€¼</strong> - <code>@ManyToOne</code> é è¨­ Eager æ˜¯å€‹é™·é˜±</li><li><strong>åœ¨è¿´åœˆè£¡è§¸ç™¼ Lazy</strong> - ç¶“å…¸ N+1 å•é¡Œ</li><li><strong>é–‹ OSIV ä¾†é€ƒé¿å•é¡Œ</strong> - æ²»æ¨™ä¸æ²»æœ¬</li></ol><h2 id="ç¸½çµ" tabindex="-1">ç¸½çµ <a class="header-anchor" href="#ç¸½çµ" aria-label="Permalink to &quot;ç¸½çµ&quot;">â€‹</a></h2><ol><li><strong>Lazy æ˜¯ä½ çš„æœ‹å‹</strong> - é è¨­ Lazyï¼Œéœ€è¦æ™‚å†æŠ“</li><li><strong>N+1 æ˜¯ä½ çš„æ•µäºº</strong> - ç”¨ <code>JOIN FETCH</code> æ¶ˆæ»…å®ƒ</li><li><strong>å…¨ Lazy ç­–ç•¥</strong> - æ‰€æœ‰ <code>@XxxToOne</code> éƒ½è¨­ <code>LAZY</code></li><li><strong>ç²¾æº–æŠ“å–</strong> - æ ¹æ“šä½¿ç”¨å ´æ™¯æ±ºå®šè¦ä¸è¦ <code>JOIN FETCH</code></li><li><strong>ä¸è¦ä¾è³´ OSIV</strong> - ä¹–ä¹–åœ¨ Service å±¤è™•ç†å¥½è³‡æ–™</li></ol>',14);function u(v,b,m,q,F,T){const k=n("VPNolebaseInlineLinkPreview"),p=n("Mermaid"),e=n("NolebaseGitContributors"),r=n("NolebaseGitChangelog");return l(),g("div",null,[c,s("ul",null,[B,s("li",null,[D,i(" - "),a(k,{href:"./persistence-context"},{default:h(()=>[i("å…ˆè®€é€™ç¯‡")]),_:1})])]),E,(l(),y(o,null,{default:h(()=>[a(p,{id:"mermaid-237",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20A%5B%E9%9C%80%E8%A6%81%E9%97%9C%E8%81%AF%E8%B3%87%E6%96%99%E5%97%8E%EF%BC%9F%5D%20--%3E%20B%5B%E4%B8%8D%E9%9C%80%E8%A6%81%5D%0A%20%20%20%20A%20--%3E%20C%5B%E9%9C%80%E8%A6%81%5D%0A%20%20%20%20%0A%20%20%20%20B%20--%3E%20D%5B%E7%9B%B4%E6%8E%A5%E7%94%A8%20Lazy%3Cbr%2F%3E%E4%BB%80%E9%BA%BC%E9%83%BD%E4%B8%8D%E7%94%A8%E5%81%9A%5D%0A%20%20%20%20C%20--%3E%20E%5B%E6%AF%8F%E6%AC%A1%E9%83%BD%E9%9C%80%E8%A6%81%E5%97%8E%EF%BC%9F%5D%0A%20%20%20%20%0A%20%20%20%20E%20--%3E%20F%5B%E6%AF%8F%E6%AC%A1%E9%83%BD%E8%A6%81%5D%0A%20%20%20%20E%20--%3E%20G%5B%E5%81%B6%E7%88%BE%E9%9C%80%E8%A6%81%5D%0A%20%20%20%20%0A%20%20%20%20F%20--%3E%20H%5B%E8%80%83%E6%85%AE%E7%94%A8%20Eager%3Cbr%2F%3E%EF%BC%88%E4%BD%86%E4%B8%89%E6%80%9D%EF%BC%81%EF%BC%89%5D%0A%20%20%20%20G%20--%3E%20I%5B%E7%94%A8%20JOIN%20FETCH%3Cbr%2F%3E%E7%B2%BE%E6%BA%96%E6%8A%93%E5%8F%96%5D%0A%20%20%20%20%0A%20%20%20%20style%20D%20fill%3A%23c8e6c9%0A%20%20%20%20style%20I%20fill%3A%23c8e6c9%0A%20%20%20%20style%20H%20fill%3A%23ffcdd2%0A"})]),fallback:h(()=>[i(" Loading... ")]),_:1})),C,a(e),a(r)])}const _=d(A,[["render",u]]);export{P as __pageData,_ as default};
