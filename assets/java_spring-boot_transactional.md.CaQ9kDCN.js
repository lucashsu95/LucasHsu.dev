import{_ as d,c as o,m as s,a as i,J as a,w as n,b as c,au as g,V as l,E as t,o as e}from"./chunks/framework.C9sE8QFS.js";const O=JSON.parse('{"title":"@Transactional äº‹å‹™ç®¡ç† | LucasHsu.dev","description":"æ·±å…¥ç†è§£ Spring @Transactional èˆ‡æŒä¹…åŒ–ä¸Šä¸‹æ–‡çš„é—œä¿‚ï¼ŒæŒæ¡äº‹å‹™ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µ","frontmatter":{"title":"@Transactional äº‹å‹™ç®¡ç† | LucasHsu.dev","description":"æ·±å…¥ç†è§£ Spring @Transactional èˆ‡æŒä¹…åŒ–ä¸Šä¸‹æ–‡çš„é—œä¿‚ï¼ŒæŒæ¡äº‹å‹™ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µ","head":[["meta",{"name":"keywords","content":"Spring, Transactional, äº‹å‹™ç®¡ç†, JPA, æŒä¹…åŒ–ä¸Šä¸‹æ–‡"}],["meta",{"property":"og:title","content":"@Transactional äº‹å‹™ç®¡ç†"}],["meta",{"property":"og:description","content":"æ·±å…¥ç†è§£ Spring @Transactional èˆ‡æŒä¹…åŒ–ä¸Šä¸‹æ–‡çš„é—œä¿‚"}],["meta",{"property":"og:type","content":"article"}]]},"headers":[],"relativePath":"java/spring-boot/transactional.md","filePath":"java/spring-boot/transactional.md","lastUpdated":1770277310000}'),A={name:"java/spring-boot/transactional.md"},y=s("h1",{id:"transactional-äº‹å‹™ç®¡ç†",tabindex:"-1"},[i("@Transactional äº‹å‹™ç®¡ç† "),s("a",{class:"header-anchor",href:"#transactional-äº‹å‹™ç®¡ç†","aria-label":'Permalink to "@Transactional äº‹å‹™ç®¡ç†"'},"â€‹")],-1),u=s("blockquote",null,[s("p",null,[i("ğŸ“ TL;DRï¼š"),s("code",null,"@Transactional"),i(" å°±åƒæ˜¯è³‡æ–™åº«ç•Œçš„ã€Œå©šç¦®ä¸»æŒäººã€â€”â€”å®ƒå®£å¸ƒé–‹å§‹ã€è¦‹è­‰éç¨‹ã€ç¢ºä¿é›™æ–¹ï¼ˆç¨‹å¼èˆ‡è³‡æ–™åº«ï¼‰è¦å˜›ä¸€èµ·å¹¸ç¦ï¼Œè¦å˜›ä¸€èµ·å›åˆ°å–®èº«ç‹€æ…‹ã€‚è¨˜ä½ï¼š"),s("strong",null,"æ–¹æ³•å‘½åæ±ºå®šä½ çš„å‘½é‹"),i("ï¼")])],-1),B=s("h2",{id:"å‰ç½®çŸ¥è­˜",tabindex:"-1"},[i("å‰ç½®çŸ¥è­˜ "),s("a",{class:"header-anchor",href:"#å‰ç½®çŸ¥è­˜","aria-label":'Permalink to "å‰ç½®çŸ¥è­˜"'},"â€‹")],-1),D=s("li",null,[s("strong",null,"JPA åŸºç¤"),i(" - äº†è§£ Entity èˆ‡ EntityManager")],-1),b=s("li",null,[s("strong",null,"Spring AOP"),i(" - çŸ¥é“ä»€éº¼æ˜¯ä»£ç†æ¨¡å¼")],-1),v=s("strong",null,"æŒä¹…åŒ–ä¸Šä¸‹æ–‡",-1),C=l(`<h2 id="transactional-æ˜¯ä»€éº¼" tabindex="-1">@Transactional æ˜¯ä»€éº¼ï¼Ÿ <a class="header-anchor" href="#transactional-æ˜¯ä»€éº¼" aria-label="Permalink to &quot;@Transactional æ˜¯ä»€éº¼ï¼Ÿ&quot;">â€‹</a></h2><p>æƒ³åƒä½ å»éŠ€è¡Œè½‰å¸³ï¼š</p><ol><li>éŠ€è¡Œé–‹é–€ï¼ˆé–‹å•Ÿäº‹å‹™ï¼‰</li><li>å¾ A å¸³æˆ¶æ‰£éŒ¢</li><li>å¾€ B å¸³æˆ¶åŠ éŒ¢</li><li>éŠ€è¡Œèªªã€ŒOKï¼Œäº¤æ˜“å®Œæˆï¼ã€ï¼ˆCommitï¼‰</li></ol><p>ä½†å¦‚æœç¬¬ 3 æ­¥é©Ÿå¤±æ•—äº†å‘¢ï¼Ÿç¸½ä¸èƒ½éŒ¢æ†‘ç©ºæ¶ˆå¤±å§ï¼é€™æ™‚å€™éŠ€è¡Œæœƒèªªï¼šã€Œç•¶ä½œæ²’ç™¼ç”Ÿéã€ï¼ˆRollbackï¼‰ï¼ŒæŠŠéŒ¢é‚„çµ¦ Aã€‚</p><p><strong><code>@Transactional</code> å°±æ˜¯é‚£å€‹ç¢ºä¿ã€Œè¦å˜›å…¨åšï¼Œè¦å˜›å…¨ä¸åšã€çš„éŠ€è¡Œç¶“ç†ã€‚</strong></p><h3 id="å®ƒçš„ä¸‰å¤§è·è²¬" tabindex="-1">å®ƒçš„ä¸‰å¤§è·è²¬ <a class="header-anchor" href="#å®ƒçš„ä¸‰å¤§è·è²¬" aria-label="Permalink to &quot;å®ƒçš„ä¸‰å¤§è·è²¬&quot;">â€‹</a></h3><table><thead><tr><th>è·è²¬</th><th>èªªæ˜</th><th>æ¯”å–»</th></tr></thead><tbody><tr><td>é–‹å•Ÿåˆç´„</td><td>æ–¹æ³•é–‹å§‹æ™‚ç¢ºä¿æœ‰ <code>EntityManager</code></td><td>å©šç¦®é–‹å ´ç™½</td></tr><tr><td>å®šç¾©è¡Œç‚º</td><td>å‘Šè¨´è³‡æ–™åº«ã€Œé€™æ˜¯ä¸å¯åˆ†å‰²çš„æ¥­å‹™ã€</td><td>ã€Œä½ é¡˜æ„å—ï¼Ÿã€</td></tr><tr><td>è§¸ç™¼å›æ»¾</td><td>å‡ºéŒ¯æ™‚é€šçŸ¥è³‡æ–™åº«å›æ»¾</td><td>ã€Œæˆ‘åå°ï¼ã€â†’ å©šç¦®å–æ¶ˆ</td></tr><tr><td>å¼·åˆ¶åŒæ­¥</td><td>æ–¹æ³•æ­£å¸¸çµæŸæ™‚è§¸ç™¼ <code>flush()</code></td><td>ã€Œæˆ‘å®£å¸ƒä½ å€‘...ã€â†’ è“‹ç« ç”Ÿæ•ˆ</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">âš ï¸ æœ€é‡è¦çš„ä¸€é»</p><p>ç•¶ <code>@Transactional</code> æ–¹æ³•æ­£å¸¸çµæŸæ™‚ï¼ŒSpring æœƒåŸ·è¡Œ <code>commit</code>ï¼Œ<strong>å¼·åˆ¶è§¸ç™¼ä¸€æ¬¡ <code>flush()</code></strong>ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼ä½ æ”¹äº† Entity å»æ²’å‘¼å« <code>save()</code>ï¼Œè³‡æ–™é‚„æ˜¯æœƒå­˜é€²å»çš„åŸå› ï¼</p></div><h2 id="äº‹å‹™å…¨åŸŸæ””æˆªå™¨-å‘½åå³å‘½é‹" tabindex="-1">äº‹å‹™å…¨åŸŸæ””æˆªå™¨ï¼šå‘½åå³å‘½é‹ <a class="header-anchor" href="#äº‹å‹™å…¨åŸŸæ””æˆªå™¨-å‘½åå³å‘½é‹" aria-label="Permalink to &quot;äº‹å‹™å…¨åŸŸæ””æˆªå™¨ï¼šå‘½åå³å‘½é‹&quot;">â€‹</a></h2><p>åœ¨ <code>modules/.../databaseconfig/Config.java</code> çš„ <code>transactionInterceptor</code> è£¡ï¼Œå®šç¾©äº†å…©å¥—ã€Œåˆç´„ã€ï¼š</p><h3 id="ç¬¬ä¸€ç¨®-å¯«å…¥åˆç´„-requiredattribute" tabindex="-1">ç¬¬ä¸€ç¨®ï¼šå¯«å…¥åˆç´„ <code>requiredAttribute</code> <a class="header-anchor" href="#ç¬¬ä¸€ç¨®-å¯«å…¥åˆç´„-requiredattribute" aria-label="Permalink to &quot;ç¬¬ä¸€ç¨®ï¼šå¯«å…¥åˆç´„ \`requiredAttribute\`&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// é€™äº›æ–¹æ³•åé–‹é ­æœƒè‡ªå‹•ç²å¾—äº‹å‹™ä¿è­·</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">add</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> save</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> create</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> update</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> delete</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span></span></code></pre></div><table><thead><tr><th>è¨­å®š</th><th>å€¼</th><th>ç™½è©±æ–‡</th></tr></thead><tbody><tr><td>è¡Œç‚º</td><td><code>PROPAGATION_REQUIRED</code></td><td>ã€Œå¿…é ˆæœ‰äº‹å‹™ï¼æ²’æœ‰å°±é–‹ä¸€å€‹ï¼Œæœ‰å°±åŠ å…¥ã€</td></tr><tr><td>éŒ¯èª¤è™•ç†</td><td>é‡ <code>RuntimeException</code> å›æ»¾</td><td>ã€Œå‡ºäº‹äº†ï¼Ÿç•¶ä½œæ²’ç™¼ç”Ÿéã€</td></tr></tbody></table><h3 id="ç¬¬äºŒç¨®-å”¯è®€åˆç´„-readonlytransactionattributes" tabindex="-1">ç¬¬äºŒç¨®ï¼šå”¯è®€åˆç´„ <code>readOnlyTransactionAttributes</code> <a class="header-anchor" href="#ç¬¬äºŒç¨®-å”¯è®€åˆç´„-readonlytransactionattributes" aria-label="Permalink to &quot;ç¬¬äºŒç¨®ï¼šå”¯è®€åˆç´„ \`readOnlyTransactionAttributes\`&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// é€™äº›æ–¹æ³•åé–‹é ­åªèƒ½è®€ä¸èƒ½å¯«</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">find</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> get</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> search</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> getCount</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ï¼ˆå…¶ä»–æ‰€æœ‰ï¼‰</span></span></code></pre></div><table><thead><tr><th>è¨­å®š</th><th>å€¼</th><th>ç™½è©±æ–‡</th></tr></thead><tbody><tr><td>è¡Œç‚º</td><td><code>PROPAGATION_NOT_SUPPORTED</code></td><td>ã€Œä¸éœ€è¦äº‹å‹™ï¼Œæˆ‘åªæ˜¯ä¾†çœ‹çœ‹ã€</td></tr><tr><td>å”¯è®€</td><td><code>setReadOnly(true)</code></td><td>ã€Œæˆ‘ç™¼èª“åªçœ‹ä¸æ‘¸ã€</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">ğŸ’¡ ç‚ºä»€éº¼è¦é€™æ¨£è¨­è¨ˆï¼Ÿ</p><p><strong>ç‚ºä»€éº¼ <code>readOnly</code>ï¼Ÿ</strong> æ•ˆèƒ½å„ªåŒ–ï¼å”¯è®€æ¨¡å¼è®“è³‡æ–™åº«ä¸åšé–å®šï¼ŒHibernate ä¹Ÿçœå» Dirty Checking çš„åŠŸå¤«ã€‚å°±åƒåœ–æ›¸é¤¨çš„ã€Œåƒ…ä¾›é–±è¦½ã€å€â€”â€”ä¸ç”¨æ“”å¿ƒæ›¸è¢«å·èµ°ï¼Œç®¡ç†è¼•é¬†å¾ˆå¤šã€‚</p><p><strong>ç‚ºä»€éº¼ <code>NOT_SUPPORTED</code>ï¼Ÿ</strong> é¿å…æŸ¥è©¢æ“ä½œæ„å¤–é–‹å•Ÿä¸å¿…è¦çš„äº‹å‹™ï¼Œç¯€çœè³‡æ–™åº«è³‡æºã€‚ç•¢ç«Ÿåªæ˜¯ä¾†ç¿»ç¿»æ›¸ï¼Œä½•å¿…ç°½å€Ÿæ›¸è­‰å‘¢ï¼Ÿ</p></div><div class="danger custom-block"><p class="custom-block-title">ğŸš¨ å‘½åé™·é˜±</p><p>æ–¹æ³•å‘½å <strong>æ±ºå®š</strong> ä½ æœ‰æ²’æœ‰äº‹å‹™ä¿è­·ï¼</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// âœ… æœ‰äº‹å‹™ä¿è­·</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> saveUser</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> }</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> updateOrder</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// âŒ æ²’æœ‰äº‹å‹™ä¿è­·ï¼ˆå³ä½¿ä½ åŠ äº† @Transactionalï¼‰</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> processUser</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> }</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // ä¸ç¬¦åˆå‘½åè¦å‰‡</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> handleOrder</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> }</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // æœƒè¢« * æ””æˆªæˆå”¯è®€</span></span></code></pre></div><p>å°±ç®—ä½ åœ¨æ–¹æ³•ä¸Šæ‰‹å‹•æ‰“ <code>@Transactional</code>ï¼Œæ””æˆªå™¨çš„å„ªå…ˆç´šæ›´é«˜ï¼Œé‚„æ˜¯æœƒè¢«ç•¶æˆå”¯è®€è™•ç†ï¼</p></div><h2 id="aop-ä»£ç†-å¹•å¾ŒåŠŸè‡£-ğŸ¬" tabindex="-1">AOP ä»£ç†ï¼šå¹•å¾ŒåŠŸè‡£ ğŸ¬ <a class="header-anchor" href="#aop-ä»£ç†-å¹•å¾ŒåŠŸè‡£-ğŸ¬" aria-label="Permalink to &quot;AOP ä»£ç†ï¼šå¹•å¾ŒåŠŸè‡£ ğŸ¬&quot;">â€‹</a></h2><p>Spring ä¸æ˜¯ç›´æ¥åœ¨ä½ çš„ç¨‹å¼ç¢¼è£¡æ’å…¥äº¤æ˜“é‚è¼¯ï¼Œè€Œæ˜¯é€é <strong>AOPï¼ˆAspect Oriented Programmingï¼‰</strong> å»ºç«‹ä¸€å€‹ã€Œæ›¿èº«æ¼”å“¡ã€â€”â€”ä»£ç†ç‰©ä»¶ã€‚</p>`,20),E=l(`<h3 id="ä»£ç†çš„å·¥ä½œæµç¨‹" tabindex="-1">ä»£ç†çš„å·¥ä½œæµç¨‹ <a class="header-anchor" href="#ä»£ç†çš„å·¥ä½œæµç¨‹" aria-label="Permalink to &quot;ä»£ç†çš„å·¥ä½œæµç¨‹&quot;">â€‹</a></h3><ol><li><strong>é–‹é–€ç‡Ÿæ¥­</strong> - é€é <code>TransactionManager</code> é–‹å•Ÿè³‡æ–™åº«é€£ç·š</li><li><strong>è«‹å›å…¥ç”•</strong> - å‘¼å«ä½ åŸæœ¬çš„æ–¹æ³•å…§å®¹</li><li><strong>çµå¸³èµ°äºº</strong> - æ–¹æ³•çµæŸå¾Œæ±ºå®šè¦ <code>commit</code>ï¼ˆè§¸ç™¼ Flushï¼‰é‚„æ˜¯ <code>rollback</code></li></ol><h2 id="å¯¦éš›ç¯„ä¾‹" tabindex="-1">å¯¦éš›ç¯„ä¾‹ <a class="header-anchor" href="#å¯¦éš›ç¯„ä¾‹" aria-label="Permalink to &quot;å¯¦éš›ç¯„ä¾‹&quot;">â€‹</a></h2><h3 id="ç¯„ä¾‹-1-åŸºç¤äº‹å‹™" tabindex="-1">ç¯„ä¾‹ 1ï¼šåŸºç¤äº‹å‹™ <a class="header-anchor" href="#ç¯„ä¾‹-1-åŸºç¤äº‹å‹™" aria-label="Permalink to &quot;ç¯„ä¾‹ 1ï¼šåŸºç¤äº‹å‹™&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Service</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> OrderService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> OrderRepository</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> orderRepository</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // âœ… æ–¹æ³•åä»¥ save é–‹é ­ï¼Œè‡ªå‹•æœ‰äº‹å‹™</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> saveOrder</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Order </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">order</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        orderRepository</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">save</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">order</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        // å¦‚æœé€™è£¡æ‹‹å‡º RuntimeException</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        // æ•´å€‹æ“ä½œæœƒå›æ»¾ï¼Œorder ä¸æœƒå­˜é€²è³‡æ–™åº«</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h3 id="ç¯„ä¾‹-2-äº‹å‹™å‚³æ’­çš„é™·é˜±" tabindex="-1">ç¯„ä¾‹ 2ï¼šäº‹å‹™å‚³æ’­çš„é™·é˜± <a class="header-anchor" href="#ç¯„ä¾‹-2-äº‹å‹™å‚³æ’­çš„é™·é˜±" aria-label="Permalink to &quot;ç¯„ä¾‹ 2ï¼šäº‹å‹™å‚³æ’­çš„é™·é˜±&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Service</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> UserService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // ğŸš¨ é€™å€‹æ–¹æ³•ä¸æœƒæœ‰ç¨ç«‹äº‹å‹™ï¼</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> processAndSave</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">User </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        validateUser</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">     // é©—è­‰</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        saveUser</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">         // ä½ ä»¥ç‚ºé€™è£¡æœ‰äº‹å‹™...</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // å³ä½¿é€™è£¡æœ‰äº‹å‹™ï¼Œå¾åŒä¸€å€‹é¡åˆ¥å…§éƒ¨å‘¼å«ä¹Ÿä¸æœƒç”Ÿæ•ˆ</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> saveUser</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">User </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        userRepository</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">save</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">user</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">âš ï¸ è‡ªæˆ‘å‘¼å«é™·é˜±</p><p>åŒä¸€å€‹é¡åˆ¥å…§çš„æ–¹æ³•äº’ç›¸å‘¼å«ï¼Œ<strong>ä¸æœƒè§¸ç™¼ AOP ä»£ç†</strong>ï¼å› ç‚ºä½ å‘¼å«çš„æ˜¯ <code>this.saveUser()</code>ï¼Œä¸æ˜¯ä»£ç†ç‰©ä»¶çš„æ–¹æ³•ã€‚</p><p><strong>è§£æ³•ï¼š</strong></p><ol><li>æŠŠæ–¹æ³•æ‹†åˆ°ä¸åŒçš„ Service</li><li>æ³¨å…¥è‡ªå·± <code>@Autowired private UserService self;</code> ç„¶å¾Œç”¨ <code>self.saveUser()</code></li></ol></div><h2 id="å¸¸è¦‹å•é¡Œ-faq" tabindex="-1">å¸¸è¦‹å•é¡Œ FAQ <a class="header-anchor" href="#å¸¸è¦‹å•é¡Œ-faq" aria-label="Permalink to &quot;å¸¸è¦‹å•é¡Œ FAQ&quot;">â€‹</a></h2><h3 id="q1-ç‚ºä»€éº¼æˆ‘çš„-transactional-æ²’ç”Ÿæ•ˆ" tabindex="-1">Q1ï¼šç‚ºä»€éº¼æˆ‘çš„ @Transactional æ²’ç”Ÿæ•ˆï¼Ÿ <a class="header-anchor" href="#q1-ç‚ºä»€éº¼æˆ‘çš„-transactional-æ²’ç”Ÿæ•ˆ" aria-label="Permalink to &quot;Q1ï¼šç‚ºä»€éº¼æˆ‘çš„ @Transactional æ²’ç”Ÿæ•ˆï¼Ÿ&quot;">â€‹</a></h3><p><strong>å¯èƒ½åŸå› ï¼š</strong></p><ol><li>æ–¹æ³•å‘½åä¸ç¬¦åˆæ””æˆªå™¨è¦å‰‡</li><li>å¾åŒä¸€å€‹é¡åˆ¥å…§éƒ¨å‘¼å«ï¼ˆè‡ªæˆ‘å‘¼å«é™·é˜±ï¼‰</li><li>æ–¹æ³•ä¸æ˜¯ <code>public</code> çš„</li><li>æ‹‹å‡ºçš„æ˜¯ Checked Exceptionï¼ˆé è¨­åªå›æ»¾ RuntimeExceptionï¼‰</li></ol><h3 id="q2-transactional-å¯ä»¥åŠ åœ¨-private-æ–¹æ³•ä¸Šå—" tabindex="-1">Q2ï¼š@Transactional å¯ä»¥åŠ åœ¨ private æ–¹æ³•ä¸Šå—ï¼Ÿ <a class="header-anchor" href="#q2-transactional-å¯ä»¥åŠ åœ¨-private-æ–¹æ³•ä¸Šå—" aria-label="Permalink to &quot;Q2ï¼š@Transactional å¯ä»¥åŠ åœ¨ private æ–¹æ³•ä¸Šå—ï¼Ÿ&quot;">â€‹</a></h3><p>ä¸è¡Œï¼AOP ä»£ç†åªèƒ½æ””æˆª <code>public</code> æ–¹æ³•ã€‚private æ–¹æ³•å°±åƒæ˜¯ä½ çš„å…§å¿ƒæˆ²ï¼Œå¤–ç•Œï¼ˆä»£ç†ï¼‰çœ‹ä¸åˆ°ä¹Ÿç®¡ä¸è‘—ã€‚</p><h3 id="q3-äº‹å‹™å…§çš„æŸ¥è©¢æœƒé–è¡¨å—" tabindex="-1">Q3ï¼šäº‹å‹™å…§çš„æŸ¥è©¢æœƒé–è¡¨å—ï¼Ÿ <a class="header-anchor" href="#q3-äº‹å‹™å…§çš„æŸ¥è©¢æœƒé–è¡¨å—" aria-label="Permalink to &quot;Q3ï¼šäº‹å‹™å…§çš„æŸ¥è©¢æœƒé–è¡¨å—ï¼Ÿ&quot;">â€‹</a></h3><p>çœ‹ä½ çš„éš”é›¢ç´šåˆ¥å’Œè³‡æ–™åº«è¨­å®šã€‚ä½†å¦‚æœç”¨ <code>readOnly=true</code>ï¼Œè³‡æ–™åº«é€šå¸¸æœƒç”¨æ›´è¼•é‡çš„é–æˆ–æ ¹æœ¬ä¸é–ã€‚</p><h2 id="æœ€ä½³å¯¦è¸" tabindex="-1">æœ€ä½³å¯¦è¸ <a class="header-anchor" href="#æœ€ä½³å¯¦è¸" aria-label="Permalink to &quot;æœ€ä½³å¯¦è¸&quot;">â€‹</a></h2><h3 id="âœ…-æ¨è–¦åšæ³•" tabindex="-1">âœ… æ¨è–¦åšæ³• <a class="header-anchor" href="#âœ…-æ¨è–¦åšæ³•" aria-label="Permalink to &quot;âœ… æ¨è–¦åšæ³•&quot;">â€‹</a></h3><ol><li><strong>éµå®ˆå‘½åè¦å‰‡</strong> - <code>save*</code>ã€<code>update*</code>ã€<code>delete*</code> é–‹é ­</li><li><strong>ä¿æŒæ–¹æ³•ç°¡çŸ­</strong> - äº‹å‹™æŒæœ‰æ™‚é–“è¶ŠçŸ­è¶Šå¥½</li><li><strong>åªåœ¨ Service å±¤ä½¿ç”¨</strong> - Controller å’Œ Repository ä¸è¦åŠ </li></ol><h3 id="âŒ-å¸¸è¦‹éŒ¯èª¤" tabindex="-1">âŒ å¸¸è¦‹éŒ¯èª¤ <a class="header-anchor" href="#âŒ-å¸¸è¦‹éŒ¯èª¤" aria-label="Permalink to &quot;âŒ å¸¸è¦‹éŒ¯èª¤&quot;">â€‹</a></h3><ol><li><strong>äº‹å‹™æ–¹æ³•å¤ªé•·</strong> - é–ä½è³‡æºå¤ªä¹…ï¼Œå…¶ä»–è«‹æ±‚æœƒæ’éšŠ</li><li><strong>åœ¨è¿´åœˆè£¡é–‹äº‹å‹™</strong> - æ¯æ¬¡è¿­ä»£éƒ½é–‹é—œäº‹å‹™ï¼Œæ•ˆèƒ½çˆ†ç‚¸</li><li><strong>æ··ç”¨ä¸åŒè³‡æ–™æº</strong> - è·¨è³‡æ–™åº«äº‹å‹™éœ€è¦åˆ†æ•£å¼äº‹å‹™ï¼ˆé‚£æ˜¯å¦ä¸€å€‹æ•…äº‹äº†...ï¼‰</li></ol><h2 id="ç¸½çµ" tabindex="-1">ç¸½çµ <a class="header-anchor" href="#ç¸½çµ" aria-label="Permalink to &quot;ç¸½çµ&quot;">â€‹</a></h2><ol><li><strong><code>@Transactional</code> æ˜¯äº‹å‹™çš„ç”Ÿå‘½é€±æœŸç®¡ç†è€…</strong> - é–‹å•Ÿã€ç›£æ§ã€æäº¤æˆ–å›æ»¾</li><li><strong>å‘½åæ±ºå®šå‘½é‹</strong> - æ””æˆªå™¨æœƒæ ¹æ“šæ–¹æ³•åæ±ºå®šäº‹å‹™è¡Œç‚º</li><li><strong>å°å¿ƒè‡ªæˆ‘å‘¼å«é™·é˜±</strong> - åŒé¡åˆ¥å…§éƒ¨å‘¼å«ä¸æœƒè§¸ç™¼ä»£ç†</li><li><strong>å”¯è®€å„ªåŒ–å¾ˆé‡è¦</strong> - æŸ¥è©¢æ–¹æ³•è¨˜å¾—ç”¨ <code>find*</code>ã€<code>get*</code> é–‹é ­</li><li><strong>AOP ä»£ç†æ˜¯å¹•å¾ŒåŠŸè‡£</strong> - ç†è§£å®ƒæ‰èƒ½é¿å…è¸©å‘</li></ol>`,23);function m(_,P,q,T,f,S){const h=t("VPNolebaseInlineLinkPreview"),r=t("Mermaid"),p=t("NolebaseGitContributors"),k=t("NolebaseGitChangelog");return e(),o("div",null,[y,u,B,s("ul",null,[D,b,s("li",null,[v,i(" - "),a(h,{href:"./persistence-context"},{default:n(()=>[i("å…ˆè®€é€™ç¯‡")]),_:1})])]),C,(e(),c(g,null,{default:n(()=>[a(r,{id:"mermaid-246",class:"mermaid",graph:"flowchart%20LR%0A%20%20S%5B%22%E4%BD%A0%E7%9A%84%20Service%3Cbr%2F%3EuserService.saveUser()%22%5D%20--%3E%20P%0A%20%20subgraph%20P%5B%22Spring%20%E5%81%9A%E7%9A%84%E4%BA%8B%3Cbr%2F%3EuserService%24%24EnhancerBySpring%22%5D%0A%20%20%20%20direction%20TB%0A%20%20%20%20A%5B%221.%20%E9%96%8B%E5%95%9F%E4%BA%8B%E5%8B%99%22%5D%0A%20%20%20%20B%5B%222.%20%E5%91%BC%E5%8F%AB%E7%9C%9F%E6%AD%A3%E7%9A%84%20saveUser()%22%5D%0A%20%20%20%20C%5B%223.%20commit%20%E6%88%96%20rollback%22%5D%0A%20%20%20%20A%20--%3E%20B%20--%3E%20C%0A%20%20end%0A"})]),fallback:n(()=>[i(" Loading... ")]),_:1})),E,a(p),a(k)])}const R=d(A,[["render",m]]);export{O as __pageData,R as default};
