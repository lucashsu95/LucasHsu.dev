---
outline: deep
---
# è³¼ç‰©è»Š

> ğŸ“ TL;DR
- MVPï¼šå•†å“æ¸…å–® â†’ åŠ å…¥è³¼ç‰©è»Š â†’ èª¿æ•´æ•¸é‡ â†’ è¨ˆç®—ç¸½é¡ â†’ çµå¸³å‰é©—è­‰ã€‚
- ç‹€æ…‹ç®¡ç†ï¼šç”¨ä¸€ä»½ `cart` é™£åˆ—å­˜ `{id, name, price, qty}`ï¼Œæ‰€æœ‰æ“ä½œæ”¹é€™ä»½ stateï¼Œå†æ¸²æŸ“ã€‚
- å¸¸è¦‹åŠŸèƒ½ï¼šæ•¸é‡ä¸Šä¸‹é™ã€ç§»é™¤é …ç›®ã€å°è¨ˆ/ç¸½è¨ˆã€å„ªæƒ ç¢¼ã€æŒä¹…åŒ–(LocalStorage)ã€‚

## å‰ç½®çŸ¥è­˜
- é™£åˆ—æ“ä½œï¼š`find`ã€`map`ã€`filter`ã€‚
- æ•¸å­—è™•ç†ï¼šå°è¨ˆ = `price * qty`ï¼Œç¸½è¨ˆ = `reduce`ã€‚
- LocalStorage æˆ–å…¨åŸŸ stateï¼ˆRedux/Context/Piniaï¼‰ã€‚

## åŸºæœ¬æµç¨‹
```mermaid
flowchart LR
	A[å•†å“æ¸…å–®] -->|åŠ å…¥| B[è³¼ç‰©è»Šé™£åˆ—]
	B --> C[æ›´æ–°æ•¸é‡]
	C --> D[è¨ˆç®—å°è¨ˆ]
	D --> E[è¨ˆç®—ç¸½é¡/é‹è²»/æŠ˜æ‰£]
	E --> F[çµå¸³é©—è­‰]
```

## ç¯„ä¾‹è³‡æ–™çµæ§‹
```javascript
const products = [
	{ id: 'p1', name: 'T-Shirt', price: 480 },
	{ id: 'p2', name: 'Shoes', price: 1280 }
]

let cart = [
	// { id: 'p1', name: 'T-Shirt', price: 480, qty: 2 }
]
```

## æ ¸å¿ƒæ“ä½œ (åŸç”Ÿ JS)

```javascript
const addToCart = (product) => {
	const exists = cart.find((item) => item.id === product.id)
	if (exists) {
		exists.qty = Math.min(exists.qty + 1, 10) // ä¸Šé™ 10 ä»¶
	} else {
		cart.push({ ...product, qty: 1 })
	}
	persist()
	render()
}

const updateQty = (id, nextQty) => {
	cart = cart
		.map((item) =>
			item.id === id ? { ...item, qty: Math.min(Math.max(nextQty, 1), 10) } : item
		)
		.filter((item) => item.qty > 0)
	persist()
	render()
}

const removeItem = (id) => {
	cart = cart.filter((item) => item.id !== id)
	persist()
	render()
}

const summary = () => {
	const subtotal = cart.reduce((sum, i) => sum + i.price * i.qty, 0)
	const shipping = subtotal >= 1500 ? 0 : 120
	const discount = subtotal >= 2000 ? 200 : 0
	return { subtotal, shipping, discount, total: subtotal + shipping - discount }
}

const persist = () => localStorage.setItem('cart', JSON.stringify(cart))
const load = () => {
	cart = JSON.parse(localStorage.getItem('cart') || '[]')
	render()
}
```

## ç°¡æ˜“ UI ç‰‡æ®µ

```html
<ul id="product-list"></ul>
<ul id="cart-list"></ul>
<p id="total"></p>

<script>
const $ = (s) => document.querySelector(s)

function renderProducts() {
	$('#product-list').innerHTML = products
		.map(
			(p) => `
			<li>
				<span>${p.name} - $${p.price}</span>
				<button data-id="${p.id}" data-action="add">åŠ å…¥</button>
			</li>`
		)
		.join('')
}

function renderCart() {
	const { subtotal, shipping, discount, total } = summary()
	$('#cart-list').innerHTML = cart
		.map(
			(item) => `
			<li data-id="${item.id}">
				<span>${item.name}</span>
				<span>$${item.price}</span>
				<input type="number" min="1" max="10" value="${item.qty}" data-action="qty" />
				<span>å°è¨ˆ $${item.price * item.qty}</span>
				<button data-action="remove">ç§»é™¤</button>
			</li>`
		)
		.join('')
	$('#total').textContent = `å°è¨ˆ ${subtotal}ï¼Œé‹è²» ${shipping}ï¼ŒæŠ˜æ‰£ ${discount}ï¼Œç¸½è¨ˆ ${total}`
}

document.addEventListener('click', (e) => {
	const id = e.target.dataset.id
	const action = e.target.dataset.action
	if (action === 'add') addToCart(products.find((p) => p.id === id))
	if (action === 'remove') removeItem(e.target.closest('li').dataset.id)
})

document.addEventListener('input', (e) => {
	if (e.target.dataset.action === 'qty') {
		const id = e.target.closest('li').dataset.id
		updateQty(id, Number(e.target.value))
	}
})

renderProducts()
load()
</script>
```

## å¸¸è¦‹åŠŸèƒ½æ¸…å–®
- æ•¸é‡ä¸Šä¸‹é™ã€ç§»é™¤é …ç›®ã€æ¸…ç©ºè³¼ç‰©è»Š
- å„ªæƒ ç¢¼/æŠ˜æ‰£ï¼ˆå…ˆé©—è­‰æ ¼å¼ï¼Œå†æŠ˜æŠµï¼‰
- é‹è²»é‚è¼¯ï¼šæ»¿é¡å…é‹ã€æˆ–ä¾é‡é‡è¨ˆè²»
- å¤±æ•ˆè™•ç†ï¼šè‹¥å•†å“ä¸‹æ¶/åº«å­˜ä¸è¶³ï¼Œçµå¸³å‰é˜»æ“‹ä¸¦æç¤º

## å¯¦æˆ°ç·´ç¿’

### ç·´ç¿’ 1ï¼šæ•¸é‡ä¸Šä¸‹é™ï¼ˆç°¡å–®ï¼‰â­
> å°‡è³¼ç‰©è»Šæ¯é …çš„æ•¸é‡é™åˆ¶åœ¨ 1~10 ä¹‹é–“ï¼Œè¶…å‡ºå‰‡è‡ªå‹•ä¿®æ­£ã€‚

:::details ğŸ’¡ åƒè€ƒç­”æ¡ˆ
```javascript
nextQty = Math.min(Math.max(nextQty, 1), 10)
```
:::

### ç·´ç¿’ 2ï¼šé‹è²»è¦å‰‡ï¼ˆç°¡å–®ï¼‰â­
> å°è¨ˆæ»¿ 1500 å…é‹ï¼Œæœªé”å‰‡é‹è²» 120 å…ƒï¼Œè¨ˆç®—ç¸½é¡æ™‚åŠ å…¥ã€‚

:::details ğŸ’¡ åƒè€ƒç­”æ¡ˆ
```javascript
const shipping = subtotal >= 1500 ? 0 : 120
const total = subtotal + shipping
```
:::

### ç·´ç¿’ 3ï¼šå„ªæƒ ç¢¼é©—è­‰ï¼ˆä¸­ç­‰ï¼‰â­â­
> åŠ å…¥å„ªæƒ ç¢¼è¼¸å…¥æ¡†ï¼Œè¼¸å…¥ `SAVE200` æŠ˜æŠµ 200 å…ƒï¼Œå…¶é¤˜ä¸æŠ˜æŠµä¸¦æç¤ºã€‚

:::details ğŸ’¡ åƒè€ƒç­”æ¡ˆèˆ‡æç¤º
```javascript
const applyCoupon = (code) => (code === 'SAVE200' ? 200 : 0)
const discount = applyCoupon(userInput)
const total = subtotal + shipping - discount
```
:::

## å»¶ä¼¸é–±è®€
- MDN: [Array.prototype.reduce](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce) - è¨ˆç®—ç¸½é¡å¸¸ç”¨
- Stripe Docs: Checkout å‰çš„é©—è­‰èˆ‡é‡‘é¡è¨ˆç®—
- React/Pinia/Redux å®˜æ–¹æ–‡ä»¶ï¼šç‹€æ…‹ç®¡ç†æ¨¡å¼

## FAQ
- Q: é‡‘é¡å‡ºç¾æµ®é»æ•¸èª¤å·®ï¼Ÿ
	- A: é‡‘é¡ä»¥ã€Œæ•´æ•¸åˆ†ã€è¨ˆç®—ï¼Œä¾‹å¦‚å­˜æˆ `priceInCents`ï¼Œè¨ˆç®—å¾Œå†é™¤ä»¥ 100 é¡¯ç¤ºã€‚
- Q: è³¼ç‰©è»Šåˆ·æ–°å¾Œæ¶ˆå¤±ï¼Ÿ
	- A: è«‹åœ¨åˆå§‹åŒ–æ™‚è®€å– LocalStorageï¼Œä¸¦åœ¨æ¯æ¬¡è®Šæ›´å¾Œå¯«å›ã€‚
- Q: è·¨é é¢å…±ç”¨è³¼ç‰©è»Šï¼Ÿ
	- A: å¯ç”¨ Context/Redux/Pinia æˆ– URL åŒæ­¥ï¼›äº¦å¯å°‡ cart å­˜å…¥å¾Œç«¯ sessionã€‚
